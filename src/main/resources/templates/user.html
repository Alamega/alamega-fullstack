<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="layout :: head"></th:block>
    <title th:text="${user.getUsername()}">Пользователь</title>
</head>
<body>
<div class="container">
    <header th:include="layout :: header"></header>

    <div class="full-wrapper">
        <div class="content">
            <!--/*@thymesVar id="user" type="com.alamega.alamegaspringapp.user.User"*/-->
            <p class="title" th:text="${user.getUsername()}"></p>
            <div th:switch="${user.getRole}">
                <p>
                    Роль:
                    <span th:case="'ADMIN'" style="color: red">Администратор</span>
                    <span th:case="'USER'" style="color: green">Пользователь</span>
                    <span th:case="*">Чёрт</span>
                </p>
            </div>

            <!--/*@thymesVar id="currentUser" type="com.alamega.alamegaspringapp.user.User"*/-->
            <th:block th:if="${currentUser.getUsername() == user.getUsername()}" >
                <script>
                    function changeVisible() {
                        let post = document.getElementById("new-post");
                        if (post.style.display == "none"){
                            post.style.display="";
                        } else {
                            post.style.display="none";
                        }
                    }
                </script>
                <button class="button" onclick="changeVisible()">Новый пост</button>
                <div id="new-post" style="display: none">
                    <form class="form_center" th:action="@{/posts}" method="post">
                        <label for="text">Содержание поста</label>
                        <textarea maxlength="1024" rows="5" class="new-post-textarea" name="text" id="text"></textarea>
                        <button class="button">Опубликовать</button>
                    </form>
                </div>
            </th:block>

            <!--/*@thymesVar id="posts" type="com.alamega.alamegaspringapp.post.Post[]"*/-->
            <div class="posts">
                <div class="post" th:each="post : ${posts}">
                    <div class="post-header">
                        <script th:inline="javascript">
                            hour = [[${post.getDate().get(11)}]];
                            min = [[${post.getDate().get(12)}]];
                            day = [[${post.getDate().get(5)}]];
                            month = [[${(post.getDate().get(2) + 1)}]];
                            year = [[${post.getDate().get(1)}]];
                            if ((min + "").length == 1) {
                                min = "0" + min;
                            }
                            if ((day + "").length == 1) {
                                day = "0" + day;
                            }
                            if ((month + "").length == 1) {
                                month = "0" + month;
                            }
                            document.write("<p class=\"post-date\">" + hour + ":" + min + " " + day + "." + month + "." + year + "</p>");
                        </script>
                        <th:block th:if="${currentUser.getRole() == 'ADMIN' || currentUser.getId() == user.getId()}">
                            <form style="width: 100%" th:action="@{'/posts/delete/'+${post.getId()}}" method="post">
                                <button class="btn-to-a">Удалить</button>
                            </form>
                        </th:block>
                    </div>
                    <hr>
                    <p class="post-text" th:text="${post.getText()}"></p>
                </div>
            </div>
        </div>
        <div class="sidebar">
            <div th:replace="layout :: sidebar"></div>
        </div>
    </div>

    <footer th:include="layout :: footer"></footer>
</div>
</body>
</html>
